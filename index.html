<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CÃ¢y thÃ´ng Noel ðŸŽ„âœ¨</title>
  <style>
    html, body { height: 100%; margin: 0; background: #0b1020; }
    body { display: grid; place-items: center; user-select: none; }
    canvas{
      width: 900px; height: 700px;
      border-radius: 18px;
      box-shadow: 0 18px 60px rgba(0,0,0,.55);
      background: #0b1020;
    }
  </style>
</head>
<body>
  <canvas id="c"></canvas>

<script>
(() => {
  const canvas = document.getElementById("c");
  const ctx = canvas.getContext("2d");

  const W = 900, H = 700;
  const DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
  canvas.width = Math.floor(W * DPR);
  canvas.height = Math.floor(H * DPR);
  ctx.setTransform(DPR, 0, 0, DPR, 0, 0);

  const BG = "#0b1020";
  const SNOW = "#d9e7ff";
  const TREE_OUTLINE = "#083a1b";
  const GREENS = ["#0f8a3b", "#0c7a34", "#0a6b2d"];
  const TRUNK = "#8b5a2b";
  const TRUNK_OUTLINE = "#5a381a";
  const LIGHTS = ["#ff3b3b", "#ffd43b", "#3bb3ff", "#ff55d9", "#7cff6b", "#ffffff"];

  let paused = false;
  let styleMode = 0;

  function rand(a,b){ return a + Math.random()*(b-a); }
  function randi(a,b){ return Math.floor(rand(a,b+1)); }
  function clamp(x,a,b){ return Math.max(a, Math.min(b,x)); }

  const tree = {
    baseY: 480,
    levels: 7,
    baseWidth: 520,
    triH: 120,
    layerGap: 55
  };

  function treeWidthAtY(y){
    const bottom = 520 - 40;
    const top = 140;
    const t = clamp((y - top) / (bottom - top), 0, 1);
    return (1 - t) * 60 + t * tree.baseWidth;
  }

  const snow = [];
  function resetSnow(){
    snow.length = 0;
    for (let i=0;i<220;i++){
      snow.push({
        x: rand(-30, W+30),
        y: rand(-30, H+30),
        r: rand(1.2, 4.8),
        vy: rand(0.9, 3.2),
        drift: rand(-0.6, 0.6),
        tw: rand(0, Math.PI*2),
      });
    }
  }

  const bulbs = [];
  function resetBulbs(){
    bulbs.length = 0;
    for (let i=0;i<80;i++){
      const y = randi(190, 410);
      const w = treeWidthAtY(y);
      const x = W/2 + rand(-w*0.42, w*0.42);
      bulbs.push({
        x, y,
        size: randi(6, 14),
        base: LIGHTS[randi(0, LIGHTS.length-1)],
        phase: randi(0, 11),
      });
    }
  }

  resetSnow();
  resetBulbs();

  function drawBackground(){
    ctx.fillStyle = BG;
    ctx.fillRect(0,0,W,H);
    ctx.fillStyle = "#101a35";
    ctx.fillRect(0, 670, W, 30);
  }

  function triPath(x1,y1,x2,y2,x3,y3){
    ctx.beginPath();
    ctx.moveTo(x1,y1);
    ctx.lineTo(x2,y2);
    ctx.lineTo(x3,y3);
    ctx.closePath();
  }

  function drawTree(time){
    for (let i=0;i<tree.levels;i++){
      const w = tree.baseWidth - i*60;
      const y = tree.baseY - i*tree.layerGap;
      triPath(W/2-w/2,y,W/2+w/2,y,W/2,y-tree.triH);
      ctx.fillStyle = GREENS[i % GREENS.length];
      ctx.fill();
      ctx.strokeStyle = TREE_OUTLINE;
      ctx.stroke();
    }

    ctx.fillStyle = TRUNK;
    ctx.fillRect(W/2-45, tree.baseY+5, 90, 110);
  }

  function drawGifts(){
    const gifts = [
      [-260,80,"#ff3b3b","#ffd43b"],
      [-160,70,"#3bb3ff","#ffffff"],
      [-60,90,"#ff55d9","#ffd43b"],
      [70,75,"#7cff6b","#ffffff"]
    ];
    gifts.forEach(g=>{
      ctx.fillStyle=g[2];
      ctx.fillRect(W/2+g[0],610,g[1],g[1]);
    });
  }

  function drawSnow(){
    ctx.fillStyle = SNOW;
    snow.forEach(f=>{
      f.y+=f.vy;
      if(f.y>H) f.y=-10;
      ctx.beginPath();
      ctx.arc(f.x,f.y,f.r,0,Math.PI*2);
      ctx.fill();
    });
  }

  function loop(){
    drawBackground();
    drawTree();
    drawGifts();
    drawSnow();
    requestAnimationFrame(loop);
  }

  requestAnimationFrame(loop);
})();
</script>
</body>
</html>
