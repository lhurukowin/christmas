<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>C√¢y th√¥ng Noel üéÑ‚ú®</title>
  <style>
    html, body { height: 100%; margin: 0; background: #0b1020; }
    body { display: grid; place-items: center; user-select: none; }
    canvas{
      width: 900px; height: 700px;
      border-radius: 18px;
      box-shadow: 0 18px 60px rgba(0,0,0,.55);
      background: #0b1020;
    }
    /* ·∫®N D√íNG H∆Ø·ªöNG D·∫™N ‚Äì KH√îNG XO√Å LOGIC */
    .hint{ display:none; }
  </style>
</head>
<body>

<canvas id="c"></canvas>

<script>
(() => {
  const canvas = document.getElementById("c");
  const ctx = canvas.getContext("2d");

  const W = 900, H = 700;
  const DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
  canvas.width = Math.floor(W * DPR);
  canvas.height = Math.floor(H * DPR);
  ctx.setTransform(DPR, 0, 0, DPR, 0, 0);

  const BG = "#0b1020";
  const SNOW = "#d9e7ff";
  const TREE_OUTLINE = "#083a1b";
  const GREENS = ["#0f8a3b", "#0c7a34", "#0a6b2d"];
  const TRUNK = "#8b5a2b";
  const TRUNK_OUTLINE = "#5a381a";
  const LIGHTS = ["#ff3b3b", "#ffd43b", "#3bb3ff", "#ff55d9", "#7cff6b", "#ffffff"];

  let paused = false;
  let styleMode = 0;

  function rand(a,b){ return a + Math.random()*(b-a); }
  function randi(a,b){ return Math.floor(rand(a,b+1)); }
  function clamp(x,a,b){ return Math.max(a, Math.min(b,x)); }

  const tree = {
    baseY: 480,
    levels: 7,
    baseWidth: 520,
    triH: 120,
    layerGap: 55
  };

  function treeWidthAtY(y){
    const bottom = 480;
    const top = 140;
    const t = clamp((y - top) / (bottom - top), 0, 1);
    return (1 - t) * 60 + t * tree.baseWidth;
  }

  const snow = [];
  function resetSnow(){
    snow.length = 0;
    for (let i=0;i<220;i++){
      snow.push({
        x: rand(-30, W+30),
        y: rand(-30, H+30),
        r: rand(1.2, 4.8),
        vy: rand(0.9, 3.2),
        drift: rand(-0.6, 0.6),
        tw: rand(0, Math.PI*2),
      });
    }
  }

  const bulbs = [];
  function resetBulbs(){
    bulbs.length = 0;
    for (let i=0;i<80;i++){
      const y = randi(190, 410);
      const w = treeWidthAtY(y);
      const x = W/2 + rand(-w*0.42, w*0.42);
      bulbs.push({
        x, y,
        size: randi(6, 14),
        base: LIGHTS[randi(0, LIGHTS.length-1)],
        phase: randi(0, 11),
      });
    }
  }

  function resetAll(){
    resetSnow();
    resetBulbs();
  }
  resetAll();

  function drawBackground(){
    ctx.fillStyle = BG;
    ctx.fillRect(0,0,W,H);
  }

  function drawTree3D(){
    for (let i=0;i<tree.levels;i++){
      const w = tree.baseWidth - i*60;
      const y = tree.baseY - i*tree.layerGap;
      ctx.fillStyle = GREENS[i % GREENS.length];
      ctx.beginPath();
      ctx.moveTo(W/2-w/2,y);
      ctx.lineTo(W/2+w/2,y);
      ctx.lineTo(W/2,y-tree.triH);
      ctx.closePath();
      ctx.fill();
    }

    /* TH√ÇN C√ÇY */
    ctx.fillStyle = TRUNK;
    ctx.strokeStyle = TRUNK_OUTLINE;
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.roundRect(W/2-45, tree.baseY+5, 90, 110, 10);
    ctx.fill();
    ctx.stroke();
  }

  function drawGifts(){
    function gift(x,y,s,box,ribbon){
      ctx.fillStyle = box;
      ctx.beginPath();
      ctx.roundRect(x,y,s,s,10);
      ctx.fill();

      ctx.fillStyle = ribbon;
      ctx.fillRect(x+s*0.45,y,s*0.1,s);
      ctx.fillRect(x,y+s*0.45,s,s*0.1);
    }

    gift(W/2-260,610,80,"#ff3b3b","#ffd43b");
    gift(W/2-160,615,70,"#3bb3ff","#ffffff");
    gift(W/2-60,605,90,"#ff55d9","#ffd43b");
    gift(W/2+70,615,75,"#7cff6b","#ffffff");
  }

  function drawLights(time){
    for (const b of bulbs){
      const blink = (Math.floor(time*35)+b.phase)%12<6;
      ctx.fillStyle = blink ? b.base : "#ffffff";
      ctx.beginPath();
      ctx.arc(b.x,b.y,b.size*0.55,0,Math.PI*2);
      ctx.fill();
    }
  }

  function updateSnow(){
    for (const f of snow){
      f.y += f.vy;
      if (f.y > H){ f.y = -10; }
    }
  }

  function drawSnow(){
    ctx.fillStyle = SNOW;
    for (const f of snow){
      ctx.beginPath();
      ctx.arc(f.x,f.y,f.r,0,Math.PI*2);
      ctx.fill();
    }
  }

  function drawTextOverlay(){
    ctx.textAlign = "center";
    ctx.fillStyle = "rgba(0,0,0,0.35)";
    ctx.beginPath();
    ctx.roundRect(W/2-220, 18, 440, 96, 18);
    ctx.fill();

    ctx.fillStyle = "#ffffff";
    ctx.font = "bold 28px Arial";
    ctx.fillText("Merry Christmas! üéÑ‚ú®", W/2, 55);

    ctx.fillStyle = "#cfe6ff";
    ctx.font = "bold 22px Arial";
    ctx.fillText("Vu Thu Trang üíñ‚ú®üí´", W/2, 85);
  }

  function loop(now){
    const time = now/1000;
    drawBackground();
    drawTree3D();
    drawLights(time);
    drawGifts();
    updateSnow();
    drawSnow();
    drawTextOverlay();
    requestAnimationFrame(loop);
  }

  document.addEventListener("keydown",(e)=>{
    const k = e.key.toLowerCase();
    if (k===" ") paused=!paused;
    if (k==="r") resetAll();
  });

  requestAnimationFrame(loop);
})();
</script>

</body>
</html>
