<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>C√¢y th√¥ng Noel üéÑ‚ú®</title>
  <style>
    html, body { height: 100%; margin: 0; background: #0b1020; }
    body { display: grid; place-items: center; user-select: none; }
    canvas{
      width: 900px; height: 700px;
      border-radius: 18px;
      box-shadow: 0 18px 60px rgba(0,0,0,.55);
      background: #0b1020;
    }
    /* ƒê√É ·∫®N HO√ÄN TO√ÄN D√íNG H∆Ø·ªöNG D·∫™N */
    .hint{ display:none; }
  </style>
</head>
<body>

<canvas id="c"></canvas>

<script>
(() => {
  const canvas = document.getElementById("c");
  const ctx = canvas.getContext("2d");

  const W = 900, H = 700;
  const DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
  canvas.width = Math.floor(W * DPR);
  canvas.height = Math.floor(H * DPR);
  ctx.setTransform(DPR, 0, 0, DPR, 0, 0);

  const BG = "#0b1020";
  const SNOW = "#d9e7ff";
  const TREE_OUTLINE = "#083a1b";
  const GREENS = ["#0f8a3b", "#0c7a34", "#0a6b2d"];
  const TRUNK = "#8b5a2b";
  const TRUNK_OUTLINE = "#5a381a";
  const LIGHTS = ["#ff3b3b", "#ffd43b", "#3bb3ff", "#ff55d9", "#7cff6b", "#ffffff"];

  let paused = false;
  let styleMode = 0;

  const tree = {
    baseY: 480,
    levels: 7,
    baseWidth: 520,
    triH: 120,
    layerGap: 55
  };

  const snow = [];
  const bulbs = [];

  function rand(a,b){ return a + Math.random()*(b-a); }
  function randi(a,b){ return Math.floor(rand(a,b+1)); }
  function clamp(x,a,b){ return Math.max(a, Math.min(b,x)); }

  function treeWidthAtY(y){
    const bottom = 520 - 40;
    const top = 140;
    const t = clamp((y - top) / (bottom - top), 0, 1);
    return (1 - t) * 60 + t * tree.baseWidth;
  }

  function resetSnow(){
    snow.length = 0;
    for (let i=0;i<220;i++){
      snow.push({
        x: rand(-30, W+30),
        y: rand(-30, H+30),
        r: rand(1.2, 4.8),
        vy: rand(0.9, 3.2),
        drift: rand(-0.6, 0.6),
        tw: rand(0, Math.PI*2),
      });
    }
  }

  function resetBulbs(){
    bulbs.length = 0;
    for (let i=0;i<80;i++){
      const y = randi(190, 410);
      const w = treeWidthAtY(y);
      const x = W/2 + rand(-w*0.42, w*0.42);
      bulbs.push({
        x, y,
        size: randi(6, 14),
        base: LIGHTS[randi(0, LIGHTS.length-1)],
        phase: randi(0, 11),
      });
    }
  }

  function resetAll(){
    resetSnow();
    resetBulbs();
  }
  resetAll();

  function drawBackground(){
    ctx.fillStyle = BG;
    ctx.fillRect(0,0,W,H);
  }

  function drawTree(){
    for (let i=0;i<tree.levels;i++){
      const w = tree.baseWidth - i*60;
      const y = tree.baseY - i*tree.layerGap;
      ctx.fillStyle = GREENS[i%GREENS.length];
      ctx.beginPath();
      ctx.moveTo(W/2-w/2,y);
      ctx.lineTo(W/2+w/2,y);
      ctx.lineTo(W/2,y-tree.triH);
      ctx.closePath();
      ctx.fill();
    }
  }

  function drawLights(time){
    for (const b of bulbs){
      const blink = (Math.floor(time*35)+b.phase)%12<6;
      ctx.fillStyle = blink ? b.base : "#ffffff";
      ctx.beginPath();
      ctx.arc(b.x,b.y,b.size*0.6,0,Math.PI*2);
      ctx.fill();
    }
  }

  function drawSnow(){
    ctx.fillStyle = SNOW;
    for (const f of snow){
      f.y += f.vy;
      if (f.y > H){ f.y = -10; }
      ctx.beginPath();
      ctx.arc(f.x,f.y,f.r,0,Math.PI*2);
      ctx.fill();
    }
  }

  function drawTextOverlay(){
    ctx.textAlign = "center";

    ctx.fillStyle = "rgba(0,0,0,0.35)";
    ctx.beginPath();
    ctx.roundRect(W/2-200, 20, 400, 90, 18);
    ctx.fill();

    ctx.fillStyle = "#fff";
    ctx.font = "bold 28px Arial";
    ctx.fillText("Merry Christmas! üéÑ‚ú®", W/2, 55);

    ctx.fillStyle = "#cfe6ff";
    ctx.font = "bold 22px Arial";
    ctx.fillText("Vu Thu Trang üíñ‚ú®üí´", W/2, 85);
  }

  function loop(t){
    drawBackground();
    drawTree();
    drawLights(t/1000);
    drawSnow();
    drawTextOverlay();
    requestAnimationFrame(loop);
  }

  document.addEventListener("keydown",(e)=>{
    const k = e.key.toLowerCase();
    if (k===" ") paused=!paused;
    if (k==="s") styleMode=(styleMode+1)%2;
    if (k==="r") resetAll();
  });

  requestAnimationFrame(loop);
})();
</script>

</body>
</html>
