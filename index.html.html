<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CÃ¢y thÃ´ng Noel ðŸŽ„âœ¨</title>
  <style>
    html, body { height: 100%; margin: 0; background: #0b1020; }
    body { display: grid; place-items: center; user-select: none; }
    canvas{
      width: 900px; height: 700px;
      border-radius: 18px;
      box-shadow: 0 18px 60px rgba(0,0,0,.55);
      background: #0b1020;
    }
    .hint{
      position: fixed;
      bottom: 10px; left: 50%;
      transform: translateX(-50%);
      color: rgba(255,255,255,.75);
      font: 13px/1.2 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: rgba(0,0,0,.25);
      padding: 8px 12px;
      border-radius: 999px;
      backdrop-filter: blur(6px);
    }
  </style>
</head>
<body>
  <canvas id="c"></canvas>
  <div class="hint">Máº¹o: báº¥m <b>Space</b> Ä‘á»ƒ táº¡m dá»«ng / cháº¡y tiáº¿p â€¢ báº¥m <b>S</b> Ä‘á»ƒ Ä‘á»•i style Ä‘Ã¨n â€¢ báº¥m <b>R</b> Ä‘á»ƒ random láº¡i</div>

<script>
(() => {
  const canvas = document.getElementById("c");
  const ctx = canvas.getContext("2d");

  const W = 900, H = 700;
  const DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
  canvas.width = Math.floor(W * DPR);
  canvas.height = Math.floor(H * DPR);
  ctx.setTransform(DPR, 0, 0, DPR, 0, 0);

  const BG = "#0b1020";
  const SNOW = "#d9e7ff";
  const TREE_OUTLINE = "#083a1b";
  const GREENS = ["#0f8a3b", "#0c7a34", "#0a6b2d"];
  const TRUNK = "#8b5a2b";
  const TRUNK_OUTLINE = "#5a381a";
  const LIGHTS = ["#ff3b3b", "#ffd43b", "#3bb3ff", "#ff55d9", "#7cff6b", "#ffffff"];

  let paused = false;
  let styleMode = 0;

  function rand(a,b){ return a + Math.random()*(b-a); }
  function randi(a,b){ return Math.floor(rand(a,b+1)); }
  function clamp(x,a,b){ return Math.max(a, Math.min(b,x)); }

  function resizeIfNeeded(){
    const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
    if (Math.abs(dpr - DPR) > 0.01) location.reload();
  }
  window.addEventListener("resize", resizeIfNeeded);

  const tree = {
    baseY: 480,
    levels: 7,
    baseWidth: 520,
    triH: 120,
    layerGap: 55
  };

  function treeWidthAtY(y){
    const bottom = 520 - 40;
    const top = 140;
    const t = clamp((y - top) / (bottom - top), 0, 1);
    const w = (1 - t) * 60 + t * tree.baseWidth;
    return w;
  }

  const snow = [];
  function resetSnow(){
    snow.length = 0;
    for (let i=0;i<220;i++){
      snow.push({
        x: rand(-30, W+30),
        y: rand(-30, H+30),
        r: rand(1.2, 4.8),
        vy: rand(0.9, 3.2),
        drift: rand(-0.6, 0.6),
        tw: rand(0, Math.PI*2),
      });
    }
  }

  const bulbs = [];
  function resetBulbs(){
    bulbs.length = 0;
    for (let i=0;i<80;i++){
      const y = randi(190, 500-90);
      const w = treeWidthAtY(y);
      const x = W/2 + rand(-w*0.42, w*0.42);
      bulbs.push({
        x, y,
        size: randi(6, 14),
        base: LIGHTS[randi(0, LIGHTS.length-1)],
        phase: randi(0, 11),
        sparkle: rand(0, 1),
      });
    }
  }

  function resetAll(){
    resetSnow();
    resetBulbs();
  }
  resetAll();

  function drawBackground(){
    ctx.fillStyle = BG;
    ctx.fillRect(0,0,W,H);

    const g = ctx.createRadialGradient(W*0.55, H*0.15, 20, W*0.55, H*0.15, 520);
    g.addColorStop(0, "rgba(120,180,255,0.18)");
    g.addColorStop(0.35, "rgba(60,120,255,0.08)");
    g.addColorStop(1, "rgba(0,0,0,0)");
    ctx.fillStyle = g;
    ctx.fillRect(0,0,W,H);

    ctx.fillStyle = "#101a35";
    ctx.fillRect(0, 670, W, 30);
  }

  function triPath(x1,y1,x2,y2,x3,y3){
    ctx.beginPath();
    ctx.moveTo(x1,y1);
    ctx.lineTo(x2,y2);
    ctx.lineTo(x3,y3);
    ctx.closePath();
  }

  function drawTree3D(time){
    const baseY = tree.baseY;
    const levels = tree.levels;
    const width = tree.baseWidth;
    const triH = tree.triH;

    for (let i=0;i<levels;i++){
      const w = width - i*60;
      const y = baseY - i*tree.layerGap;

      const x1 = W/2 - w/2, y1 = y;
      const x2 = W/2 + w/2, y2 = y;
      const x3 = W/2,       y3 = y - triH;

      const base = GREENS[i % GREENS.length];
      const grad = ctx.createLinearGradient(W/2 - w/2, y, W/2 + w/2, y - triH);
      grad.addColorStop(0, "rgba(0,0,0,0.22)");
      grad.addColorStop(0.35, base);
      grad.addColorStop(1, "rgba(255,255,255,0.08)");

      triPath(x1,y1,x2,y2,x3,y3);
      ctx.fillStyle = grad;
      ctx.fill();
      ctx.strokeStyle = TREE_OUTLINE;
      ctx.lineWidth = 2;
      ctx.stroke();

      const sheen = ctx.createLinearGradient(W/2 - w*0.1, y - triH*0.15, W/2 + w*0.1, y - triH*0.85);
      sheen.addColorStop(0, "rgba(255,255,255,0)");
      sheen.addColorStop(0.5, "rgba(255,255,255,0.07)");
      sheen.addColorStop(1, "rgba(255,255,255,0)");
      triPath(W/2 - w*0.38, y, W/2 - w*0.05, y, W/2 - w*0.12, y - triH*0.65);
      ctx.fillStyle = sheen;
      ctx.fill();

      ctx.fillStyle = "rgba(0,0,0,0.12)";
      ctx.beginPath();
      ctx.ellipse(W/2, y+10, w*0.28, 10, 0, 0, Math.PI*2);
      ctx.fill();
    }

    const trunkW = 90, trunkH = 110;
    const tx = W/2 - trunkW/2;
    const ty = baseY + 5;

    const tgrad = ctx.createLinearGradient(tx, ty, tx+trunkW, ty+trunkH);
    tgrad.addColorStop(0, "#5a381a");
    tgrad.addColorStop(0.4, TRUNK);
    tgrad.addColorStop(1, "#a9723a");

    ctx.fillStyle = tgrad;
    ctx.strokeStyle = TRUNK_OUTLINE;
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.roundRect(tx, ty, trunkW, trunkH, 10);
    ctx.fill();
    ctx.stroke();
  }

  function drawGifts(){
    function gift(x,y,s,box,ribbon){
      ctx.fillStyle = box;
      ctx.strokeStyle = "rgba(0,0,0,0.25)";
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.roundRect(x,y,s,s,10);
      ctx.fill();
      ctx.stroke();

      ctx.fillStyle = ribbon;
      ctx.beginPath();
      ctx.roundRect(x+s*0.44, y, s*0.12, s, 6);
      ctx.fill();
      ctx.beginPath();
      ctx.roundRect(x, y+s*0.44, s, s*0.12, 6);
      ctx.fill();

      ctx.fillStyle = "rgba(255,255,255,0.22)";
      ctx.beginPath();
      ctx.roundRect(x+6, y+6, s*0.28, s*0.18, 6);
      ctx.fill();
    }
    gift(W/2-260, 610, 80,  "#ff3b3b", "#ffd43b");
    gift(W/2-160, 615, 70,  "#3bb3ff", "#ffffff");
    gift(W/2- 60, 605, 90,  "#ff55d9", "#ffd43b");
    gift(W/2+ 70, 615, 75,  "#7cff6b", "#ffffff");
  }

  function drawGarlands(time){
    ctx.lineWidth = 3;
    for (let s=0;s<3;s++){
      const baseY = 330 + s*85;
      const amp = 12 + s*4;
      const huePick = (s + Math.floor(time*2)) % 3;
      const col = huePick===0 ? "#ffd43b" : (huePick===1 ? "#ffffff" : "#3bb3ff");

      ctx.strokeStyle = col;
      ctx.beginPath();
      ctx.moveTo(W/2-260, baseY);
      for (let x=-260;x<=260;x+=10){
        const y = baseY + Math.sin((x+260)/55 + time*0.8)*amp;
        ctx.lineTo(W/2 + x, y);
      }
      ctx.stroke();
    }
  }

  function hexToRgba(hex,a){
    const h = hex.replace("#","");
    const r = parseInt(h.slice(0,2),16);
    const g = parseInt(h.slice(2,4),16);
    const b = parseInt(h.slice(4,6),16);
    return `rgba(${r},${g},${b},${a})`;
  }

  function drawLights(time){
    for (const b of bulbs){
      const blink = (Math.floor(time*35) + b.phase) % 12;

      let col = b.base;
      let glow = 0.55;

      if (styleMode === 0){
        if (blink===0 || blink===1){ col="#ffffff"; glow=0.9; }
        else if (blink===5 || blink===6){ col = LIGHTS[randi(0, LIGHTS.length-1)]; glow=0.7; }
      } else {
        const tt = (Math.sin(time*6 + b.phase) + 1) * 0.5;
        col = LIGHTS[Math.floor(tt * (LIGHTS.length-1))];
        glow = 0.65 + 0.25*tt;
      }

      const g = ctx.createRadialGradient(b.x, b.y, 0, b.x, b.y, b.size*2.2);
      g.addColorStop(0, `rgba(255,255,255,${glow})`);
      g.addColorStop(0.25, hexToRgba(col, 0.55));
      g.addColorStop(1, "rgba(0,0,0,0)");
      ctx.fillStyle = g;
      ctx.beginPath();
      ctx.arc(b.x, b.y, b.size*2.2, 0, Math.PI*2);
      ctx.fill();

      ctx.fillStyle = col;
      ctx.beginPath();
      ctx.arc(b.x, b.y, b.size*0.55, 0, Math.PI*2);
      ctx.fill();

      ctx.fillStyle = "rgba(255,255,255,0.85)";
      ctx.beginPath();
      ctx.arc(b.x - b.size*0.18, b.y - b.size*0.18, Math.max(1.2, b.size*0.14), 0, Math.PI*2);
      ctx.fill();
    }
  }

  function drawStar(time){
    const cx = W/2;
    const cy = 150;
    const size = 22;

    const blink = (Math.floor(time*12)%10) < 6;
    const col = blink ? "#ffd43b" : "#ffffff";

    ctx.save();
    ctx.translate(cx,cy);
    ctx.rotate(Math.sin(time*1.2)*0.03);

    const glow = ctx.createRadialGradient(0,0,3, 0,0,40);
    glow.addColorStop(0, "rgba(255,220,80,0.85)");
    glow.addColorStop(1, "rgba(255,220,80,0)");
    ctx.fillStyle = glow;
    ctx.beginPath();
    ctx.arc(0,0,40,0,Math.PI*2);
    ctx.fill();

    ctx.fillStyle = col;
    ctx.strokeStyle = "rgba(0,0,0,0.2)";
    ctx.lineWidth = 2;

    ctx.beginPath();
    const spikes = 5;
    const outer = size;
    const inner = size * 0.45;
    let rot = -Math.PI/2;
    const step = Math.PI/spikes;
    ctx.moveTo(Math.cos(rot)*outer, Math.sin(rot)*outer);
    for (let i=0;i<spikes;i++){
      ctx.lineTo(Math.cos(rot)*outer, Math.sin(rot)*outer);
      rot += step;
      ctx.lineTo(Math.cos(rot)*inner, Math.sin(rot)*inner);
      rot += step;
    }
    ctx.closePath();
    ctx.fill();
    ctx.stroke();

    ctx.fillStyle = "rgba(255,255,255,0.9)";
    ctx.beginPath();
    ctx.arc(0,0,3.5,0,Math.PI*2);
    ctx.fill();

    ctx.restore();
  }

  function updateSnow(){
    for (const f of snow){
      f.tw += 0.03;
      f.y += f.vy;
      f.x += f.drift + Math.sin(f.tw)*0.15;

      if (f.y > H+20){
        f.y = -20;
        f.x = rand(-30, W+30);
        f.vy = rand(0.9, 3.2);
        f.drift = rand(-0.6, 0.6);
        f.r = rand(1.2, 4.8);
      }
      if (f.x > W+30) f.x = -30;
      if (f.x < -30) f.x = W+30;
    }
  }

  function drawSnow(time){
    ctx.fillStyle = SNOW;
    for (const f of snow){
      const alpha = 0.65 + 0.25*Math.sin(time*1.5 + f.tw);
      ctx.globalAlpha = alpha;
      ctx.beginPath();
      ctx.arc(f.x, f.y, f.r, 0, Math.PI*2);
      ctx.fill();
    }
    ctx.globalAlpha = 1;
  }

  function drawVignette(){
    const v = ctx.createLinearGradient(0,0,0,H);
    v.addColorStop(0, "rgba(0,0,0,0.35)");
    v.addColorStop(0.25, "rgba(0,0,0,0)");
    v.addColorStop(0.8, "rgba(0,0,0,0)");
    v.addColorStop(1, "rgba(0,0,0,0.45)");
    ctx.fillStyle = v;
    ctx.fillRect(0,0,W,H);
  }

  function drawTextOverlay(){
    const title = "Merry Christmas! ðŸŽ„âœ¨";
    const name  = "Vu Thu Trang ðŸ’–âœ¨ðŸ’«";

    const padX = 16, padY = 10, gap = 10;
    const yTop = 22;

    ctx.save();
    ctx.textAlign = "center";

    ctx.font = "bold 28px Arial, system-ui, sans-serif";
    const w1 = ctx.measureText(title).width;

    ctx.font = "bold 22px Arial, system-ui, sans-serif";
    const w2 = ctx.measureText(name).width;

    const boxW = Math.max(w1, w2) + padX*2;
    const boxH = 28 + 22 + gap + padY*2;
    const x = W/2 - boxW/2;
    const y = yTop;

    ctx.fillStyle = "rgba(0,0,0,0.35)";
    ctx.beginPath();
    ctx.roundRect(x, y, boxW, boxH, 16);
    ctx.fill();

    ctx.shadowColor = "rgba(0,0,0,0.65)";
    ctx.shadowBlur = 12;
    ctx.shadowOffsetY = 2;

    ctx.fillStyle = "rgba(255,255,255,0.96)";
    ctx.font = "bold 28px Arial, system-ui, sans-serif";
    ctx.fillText(title, W/2, y + padY + 26);

    ctx.fillStyle = "rgba(207,230,255,0.96)";
    ctx.font = "bold 22px Arial, system-ui, sans-serif";
    ctx.fillText(name, W/2, y + padY + 26 + gap + 22);

    ctx.restore();
  }

  let last = performance.now();
  let t0 = last;

  function frameLoop(now){
    const dt = Math.min(0.05, (now-last)/1000);
    last = now;

    if (!paused) t0 += dt*1000;
    const time = (t0/1000);

    drawBackground();
    drawTree3D(time);
    drawGarlands(time);
    drawLights(time);
    drawGifts();
    drawStar(time);

    if (!paused) updateSnow();
    drawSnow(time);

    drawVignette();
    drawTextOverlay();

    requestAnimationFrame(frameLoop);
  }

  document.addEventListener("keydown",(e)=>{
    const k = e.key.toLowerCase();
    if (k === " ") paused = !paused;
    if (k === "s") styleMode = (styleMode + 1) % 2;
    if (k === "r") resetAll();
  });

  requestAnimationFrame(frameLoop);
})();
</script>
</body>
</html>
